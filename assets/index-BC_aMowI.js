var q=Object.defineProperty;var X=(e,a,n)=>a in e?q(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n;var H=(e,a,n)=>X(e,typeof a!="symbol"?a+"":a,n);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();function W(e,a){const n=document.createElement("div");n.id="control-panel",n.className="absolute bottom-8 left-8 bg-gray-800 text-white p-4 rounded opacity-50",n.innerHTML=`
    <p>Use W, A, S, D keys to move your avatar</p>
    <p id="position-info">Position: x: ${Math.round(a.x)}, y: ${Math.round(a.y)}</p>
    <div class="key-grid grid grid-cols-3 gap-2 text-center">
      <div></div>
      <div id="key-w" class="bg-gray-700 rounded p-2">W</div>
      <div></div>
      <div id="key-a" class="bg-gray-700 rounded p-2">A</div>
      <div id="key-s" class="bg-gray-700 rounded p-2">S</div>
      <div id="key-d" class="bg-gray-700 rounded p-2">D</div>
    </div>
  `;const i={w:!1,a:!1,s:!1,d:!1};document.addEventListener("keydown",r=>{const l=r.key.toLowerCase();l in i&&(i[l]=!0,t(l,!0))}),document.addEventListener("keyup",r=>{const l=r.key.toLowerCase();l in i&&(i[l]=!1,t(l,!1))});function t(r,l){const o=document.getElementById(`key-${r}`);o.classList.toggle("bg-blue-500",l),o.classList.toggle("bg-gray-700",!l)}return{controlPanel:n,keys:i}}const s={player:null,camera:null,obstacles:[],enemies:[],playerBullets:[],enemyBullets:[],turretBullets:[],turrets:[],powerUps:[],wave:1,gameOver:!1,keys:{},waveEnding:null};function T(e,a,n,i,t,r,l=3){const o=[];if(n<=0)return o;const d=360/n;for(let c=0;c<n;c++){const p=(i+c*d)*Math.PI/180,g=Math.cos(p)*t,b=Math.sin(p)*t,u={x:e,y:a,vx:g,vy:b,radius:l,speed:t,color:r};o.push(u)}return o}function I(e,a){for(let n=e.length-1;n>=0;n--){const i=e[n];i.x+=i.vx,i.y+=i.vy;let t=!1;for(const r of s.obstacles)if(r.type==="rectangle"){const l=Math.max(r.x,Math.min(i.x,r.x+r.width)),o=Math.max(r.y,Math.min(i.y,r.y+r.height)),d=i.x-l,c=i.y-o;if(d*d+c*c<i.radius*i.radius){t=!0;break}}else if(r.type==="circle"){const l=i.x-r.x,o=i.y-r.y,d=Math.sqrt(l*l+o*o),c=i.radius+r.radius;if(d<c){t=!0;break}}(t||i.x<0||i.x>a.width||i.y<0||i.y>a.height)&&e.splice(n,1)}}function F(e,a){e.save(),e.translate(-s.camera.x,-s.camera.y),a.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.closePath()}),e.restore()}class D{constructor(){H(this,"events",{})}on(a,n){this.events[a]||(this.events[a]=[]),this.events[a].push(n)}off(a,n){this.events[a]&&(this.events[a]=this.events[a].filter(i=>i!==n))}emit(a,...n){this.events[a]&&this.events[a].forEach(i=>i(...n))}}const h=new D;function N(e){e.save(),e.translate(-s.camera.x,-s.camera.y),s.obstacles.forEach(a=>{a.type==="rectangle"&&(e.fillStyle=a.color,e.fillRect(a.x,a.y,a.width,a.height)),a.type==="circle"&&(e.beginPath(),e.arc(a.x,a.y,a.radius,0,Math.PI*2),e.fillStyle=a.color,e.fill())}),e.restore()}function O(e,a,n,i){let t=n,r=i,l=e.x+t,o=e.y+r;return a.forEach(d=>{if(d.type==="rectangle"){const c=Math.max(d.x,Math.min(l,d.x+d.width)),f=Math.max(d.y,Math.min(o,d.y+d.height)),p=l-c,g=o-f,b=p*p+g*g;if(b<e.radius*e.radius){const u=Math.sqrt(b),y=e.radius-u;if(u===0)l+=y;else{const x=p/u,v=g/u;l+=x*y,o+=v*y}}}else if(d.type==="circle"){const c=l-d.x,f=o-d.y,p=Math.sqrt(c*c+f*f),g=e.radius+d.radius;if(p<g){const b=g-p;if(p===0)l+=b;else{const u=c/p,y=f/p;l+=u*b,o+=y*b}}}}),t=l-e.x,r=o-e.y,{dx:t,dy:r}}const U={extraBullet:"/dot-game/extraBullet.svg",fasterFireRate:"/dot-game/fasterFireRate.svg",fasterBullets:"/dot-game/fasterBullets.svg",ship:"/dot-game/ship.svg",fastTurret:"/dot-game/fastTurret.svg",fastBulletTurret:"/dot-game/fastBulletTurret.svg",multiBulletTurret:"/dot-game/multiBulletTurret.svg",heal:"/dot-game/heal.svg"},k={};async function G(){const e=Object.entries(U).map(([a,n])=>new Promise((i,t)=>{const r=new Image;r.src=n,r.onload=()=>{k[a]=r,i()},r.onerror=()=>{console.error(`Failed to load icon: ${n}`),t()}}));await Promise.all(e),console.log("All icons loaded successfully")}function K(e){e.save(),e.translate(-s.camera.x,-s.camera.y);const a=k.ship,n=s.player.radius*2,i=s.player.x-n/2,t=s.player.y-n/2;e.drawImage(a,i,t,n,n),e.restore()}function j(e){s.camera.x=s.player.x-s.camera.width/2,s.camera.y=s.player.y-s.camera.height/2,s.camera.x=Math.max(0,Math.min(e.width-s.camera.width,s.camera.x)),s.camera.y=Math.max(0,Math.min(e.height-s.camera.height,s.camera.y));let a=0,n=0;if(s.keys.w&&(n-=s.player.speed),s.keys.s&&(n+=s.player.speed),s.keys.a&&(a-=s.player.speed),s.keys.d&&(a+=s.player.speed),a!==0&&n!==0){const o=Math.sqrt(a*a+n*n);a=a/o*s.player.speed,n=n/o*s.player.speed}const{dx:i,dy:t}=O(s.player,s.obstacles,a,n),r=s.player.x+i,l=s.player.y+t;return s.player.x=r,s.player.y=l,s.player.x=Math.max(s.player.radius,Math.min(e.width-s.player.radius,s.player.x)),s.player.y=Math.max(s.player.radius,Math.min(e.height-s.player.radius,s.player.y)),{playerNextX:r,playerNextY:l}}function z(e){const a=e-s.player.firingPattern.lastFired,n=1e3/s.player.firingPattern.fireRate;if(a>=n){const i=T(s.player.x,s.player.y,s.player.firingPattern.bulletCount,s.player.firingPattern.initialAngle,s.player.firingPattern.speed,s.player.color);s.playerBullets.push(...i),s.player.firingPattern.lastFired=e}}function V(){for(let e=s.enemyBullets.length-1;e>=0;e--){const a=s.enemyBullets[e],n=a.x-s.player.x,i=a.y-s.player.y,t=Math.sqrt(n*n+i*i),r=a.radius+s.player.radius;t<r&&h.emit("playerHit",e)}}function _(e){const a=s.player.maxHp,n=200,i=20,t=20,r=20;e.fillStyle="red",e.fillRect(t,r,n,i);const l=s.player.hp/a*n;e.fillStyle="green",e.fillRect(t,r,l,i),e.strokeStyle="white",e.lineWidth=2,e.strokeRect(t,r,n,i),e.font="16px Arial",e.fillStyle="white",e.textAlign="center",e.textBaseline="middle",e.fillText(`${s.player.hp}/${a}`,t+n/2,r+i/2)}function J(e){const a=document.createElement("canvas").getContext("2d");if(!a)return 0;a.fillStyle=e,a.fillRect(0,0,1,1);const[n,i,t]=a.getImageData(0,0,1,1).data;return .299*n+.587*i+.114*t}function Q(e){e.save(),e.translate(-s.camera.x,-s.camera.y),s.enemies.forEach(a=>{const{x:n,y:i,radius:t,color:r,hp:l}=a;e.save(),e.translate(n,i),e.beginPath(),e.ellipse(0,0,t,t*.5,0,0,Math.PI*2),e.fillStyle=r,e.fill(),e.closePath(),e.beginPath(),e.arc(0,-t*.5,t*.5,Math.PI,0),e.fillStyle="lightblue",e.fill(),e.closePath(),e.restore();const d=J(r)>150?"black":"white";e.fillStyle=d,e.font="bold 16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(`${l}`,n,i)}),e.restore()}function Z(e,a,n,i){s.enemies.forEach((t,r)=>{const l=Math.sqrt(t.vx*t.vx+t.vy*t.vy);l!==0&&(t.vx=t.vx/l*t.speed,t.vy=t.vy/l*t.speed);const o=i-t.firingPattern.lastFired,d=1e3/t.firingPattern.fireRate;if(o>=d){const u=T(t.x,t.y,t.firingPattern.bulletCount,t.firingPattern.initialAngle,t.firingPattern.speed,t.color);s.enemyBullets.push(...u),t.firingPattern.lastFired=i}let c=t.x+t.vx,f=t.y+t.vy;(c-t.radius<0||c+t.radius>e.width)&&(t.vx=-t.vx,c=t.x+t.vx),(f-t.radius<0||f+t.radius>e.height)&&(t.vy=-t.vy,f=t.y+t.vy),s.obstacles.forEach(u=>{if(u.type==="rectangle"){const y=Math.max(u.x,Math.min(c,u.x+u.width)),x=Math.max(u.y,Math.min(f,u.y+u.height)),v=c-y,M=f-x,B=v*v+M*M;if(B<t.radius*t.radius){const m=Math.sqrt(B);if(m!==0){const w=v/m,P=M/m,C=t.vx*w+t.vy*P;t.vx-=2*C*w,t.vy-=2*C*P,t.vx+=(Math.random()-.5)*.5,t.vy+=(Math.random()-.5)*.5;const L=Math.sqrt(t.vx*t.vx+t.vy*t.vy);t.vx=t.vx/L*t.speed,t.vy=t.vy/L*t.speed}else t.vx=-t.vx,t.vy=-t.vy;c=t.x+t.vx,f=t.y+t.vy}}else if(u.type==="circle"){const y=c-u.x,x=f-u.y,v=Math.sqrt(y*y+x*x),M=t.radius+u.radius;if(v<M){if(v!==0){const B=y/v,m=x/v,w=t.vx*B+t.vy*m;t.vx-=2*w*B,t.vy-=2*w*m,t.vx+=(Math.random()-.5)*.5,t.vy+=(Math.random()-.5)*.5;const P=Math.sqrt(t.vx*t.vx+t.vy*t.vy);t.vx=t.vx/P*t.speed,t.vy=t.vy/P*t.speed}else t.vx=-t.vx,t.vy=-t.vy;c=t.x+t.vx,f=t.y+t.vy}}});const p=c-a,g=f-n;if(Math.sqrt(p*p+g*g)<t.radius+s.player.radius){s.gameOver=!0;return}for(let u=0;u<s.enemies.length;u++){if(u===r)continue;const y=s.enemies[u],x=c-y.x,v=f-y.y,M=Math.sqrt(x*x+v*v),B=t.radius+y.radius;if(M<B){const m=B-M;if(M!==0){const w=x/M,P=v/M;c+=w*m*.5,f+=P*m*.5,y.x-=w*m*.5,y.y-=w*m*.5;const C=t.vx*w+t.vy*P;t.vx-=2*C*w,t.vy-=2*C*P,t.vx+=(Math.random()-.5)*.5,t.vy+=(Math.random()-.5)*.5;const L=Math.sqrt(t.vx*t.vx+t.vy*t.vy);t.vx=t.vx/L*t.speed,t.vy=t.vy/L*t.speed}else c+=m,t.vx=-t.vx,t.vy=-t.vy;c=t.x+t.vx,f=t.y+t.vy}}t.x=c,t.y=f})}function ee(){for(let e=s.enemies.length-1;e>=0;e--){const a=s.enemies[e];for(let n=s.playerBullets.length-1;n>=0;n--){const i=s.playerBullets[n],t=i.x-a.x,r=i.y-a.y,l=Math.sqrt(t*t+r*r),o=i.radius+a.radius;l<o&&h.emit("enemyHit",e,n)}}}function te(){const e=["#c084fc","#f472b6","#f87171","#22d3ee","#60a5fa","#2dd4bf","#4ade80","#fb923c"];return e[Math.floor(Math.random()*e.length)]}function ae(e,a,n,i){for(const t of i)if(t.type==="rectangle"){const r=Math.max(t.x,Math.min(e,t.x+t.width)),l=Math.max(t.y,Math.min(a,t.y+t.height)),o=e-r,d=a-l;if(o*o+d*d<n*n)return!0}else if(t.type==="circle"){const r=e-t.x,l=a-t.y,o=Math.sqrt(r*r+l*l),d=n+t.radius;if(o<d)return!0}return!1}function se(e,a,n,i){let r,l,o=0;const d=3;let c=!0,f=!0;do{r=Math.random()*(e-60)+30,l=Math.random()*(a-60)+30;const m=r-n.x,w=l-n.y;if(c=Math.sqrt(m*m+w*w)<100+n.radius+15,f=ae(r,l,15,i),o++,o>d){r=e/2,l=a/2;break}}while(c||f);const p=Math.random()*Math.PI*2,g=Math.random()*3+2,b=Math.cos(p)*g,u=Math.sin(p)*g,y=Math.floor(Math.random()*4)+2,x=Math.floor(Math.random()*5)+1,v=Math.random()*360,M=Math.random()*2+.5,B=Math.random()*3+3;return{x:r,y:l,radius:15,vx:b,vy:u,speed:g,color:te(),firingPattern:{bulletCount:x,initialAngle:v,fireRate:M,lastFired:0,speed:B},hp:y}}function $(e,a,n,i,t){const r=[];for(let l=0;l<e;l++)r.push(se(a,n,i,t));return r}const Y=1e4;function ne(e,a){const n=document.getElementById("app");if(s.waveEnding===null)return;const i=Y-(a-s.waveEnding);i<=0||(e.save(),e.font="bold 30px Arial",e.fillStyle="white",e.textAlign="center",e.fillText(`Next wave in: ${Math.ceil(i/1e3)}s`,n.offsetWidth/2,200),e.restore())}function ie(e){s.enemies=$(s.wave,e.canvas.width,e.canvas.height,s.player,s.obstacles),h.on("waveCleared",a=>{s.waveEnding===null&&(s.waveEnding=a)}),h.on("update",a=>{if(s.waveEnding===null)return;Y-(a-s.waveEnding)<=0&&(s.wave++,s.powerUps=[],s.enemies=$(s.wave+1,e.canvas.width,e.canvas.height,s.player,s.obstacles),s.waveEnding=null,h.emit("waveStarted",s.wave))})}function re(e,a){const n=["extraBullet","fasterFireRate","fasterBullets","heal"],i=n[Math.floor(Math.random()*n.length)],t={x:e.x,y:e.y,width:24,height:24,type:i,spawnTime:a};s.powerUps.push(t);const r=s.enemies.indexOf(e);r!==-1&&s.enemies.splice(r,1)}function le(){h.on("enemyHit",(e,a)=>{if(e>=0&&e<s.enemies.length&&a>=0&&a<s.playerBullets.length){const n=s.enemies[e];n.hp-=1,s.playerBullets.splice(a,1),n.hp<=0&&h.emit("enemyKilled",n,Date.now())}}),h.on("enemyKilled",(e,a)=>{re(e,a)})}function oe(e){const a=document.getElementById("app"),n=e.canvas.width,i=e.canvas.height;e.save(),e.translate(-s.camera.x,-s.camera.y),e.strokeStyle="white",e.lineWidth=3,e.strokeRect(0,0,n,i),e.restore(),e.save(),e.font="bold 24px Arial",e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.textAlign="center",e.textBaseline="top",e.fillText(`Wave: ${s.wave}`,a.offsetWidth-60,20),e.restore()}function ce(e){const{camera:a,wave:n}=s;let i=Number(localStorage.getItem("dotGameHighScore"));s.wave>i&&(localStorage.setItem("dotGameHighScore",i.toString()),i=s.wave),e.save(),e.translate(-a.x,-a.y),e.fillStyle="black",e.fillRect(a.x,a.y,a.width,a.height),e.fillStyle="red",e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(255, 255, 255, 0.5)",e.shadowBlur=4,e.font="48px Arial",e.fillText("You died",a.x+a.width/2,a.y+200),e.font="24px Arial",e.fillText(`Wave ${n}`,a.x+a.width/2,a.y+250),e.font="24px Arial",e.fillStyle="white",e.fillText(`High Score: Wave ${i}`,a.x+a.width/2,a.y+290),e.shadowBlur=0,e.restore()}const E={canvasW:2400,canvasH:1e3};function de(e){e.className="overflow-hidden bg-[url('/dot-game/space-bg.jpg')] bg-cover bg-center";const a=document.createElement("canvas");a.id="gameCanvas",e.appendChild(a);const n=a.getContext("2d");return a.width=E.canvasW,a.height=E.canvasH,n.clearRect(0,0,a.width,a.height),a}function ue(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}function fe(){h.on("playerHit",e=>{e>=0&&e<s.enemyBullets.length&&(s.player.hp-=1,s.enemyBullets.splice(e,1),s.player.hp<=0&&(s.gameOver=!0))})}function he(e){e.save(),e.translate(-s.camera.x,-s.camera.y),s.powerUps.forEach(a=>{const n=k[a.type];if(n){const i=a.width,t=a.height;e.beginPath(),e.arc(a.x,a.y,Math.max(i,t)/2+5,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.8)",e.fill(),e.closePath(),e.drawImage(n,a.x-i/2,a.y-t/2,i,t)}}),e.restore()}function pe(){for(let e=s.powerUps.length-1;e>=0;e--){const a=s.powerUps[e],n=a.x-s.player.x,i=a.y-s.player.y,t=Math.sqrt(n*n+i*i),r=s.player.radius+Math.max(a.width,a.height)/2;if(t<r){switch(a.type){case"extraBullet":s.player.firingPattern.bulletCount+=1;break;case"fasterFireRate":s.player.firingPattern.fireRate+=1;break;case"fasterBullets":s.player.firingPattern.speed+=2;break;case"heal":s.player.hp+=3,s.player.maxHp&&(s.player.hp=Math.min(s.player.hp,s.player.maxHp));break;default:{const l=a.type;throw new Error(`Unhandled power-up type: ${l}`)}}s.powerUps.splice(e,1)}}}const R={fast:"fastTurret",fastBullets:"fastBulletTurret",manyBullets:"multiBulletTurret"};function ye(e,a){if(e.save(),e.translate(-s.camera.x,-s.camera.y),s.turrets.forEach(n=>{const i=R[n.type],t=k[i],r=n.radius*2;e.drawImage(t,n.x-r/2,n.y-r/2,r,r)}),a){const n=R[a.type],i=k[n];e.globalAlpha=.7;const t=a.radius*2;e.drawImage(i,a.x-t/2,a.y-t/2,t,t),e.globalAlpha=1}s.turretBullets.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.closePath()}),e.restore()}function ge(e){s.turrets.forEach(a=>{const n=e-a.firingPattern.lastFired,i=1e3/a.firingPattern.fireRate;if(n>=i){const t=T(a.x,a.y,a.firingPattern.bulletCount,a.firingPattern.initialAngle,a.firingPattern.speed,s.player.color);s.turretBullets.push(...t),a.firingPattern.lastFired=e}})}function ve(){for(let e=s.enemies.length-1;e>=0;e--){const a=s.enemies[e];for(let n=s.turretBullets.length-1;n>=0;n--){const i=s.turretBullets[n],t=i.x-a.x,r=i.y-a.y,l=Math.sqrt(t*t+r*r),o=i.radius+a.radius;l<o&&h.emit("enemyHit",e,n)}}}const A={fast:{x:0,y:0,radius:15,type:"fast",firingPattern:{bulletCount:4,initialAngle:0,fireRate:1,lastFired:0,speed:10}},fastBullets:{x:0,y:0,radius:15,type:"fastBullets",firingPattern:{bulletCount:4,initialAngle:0,fireRate:2,lastFired:0,speed:8}},manyBullets:{x:0,y:0,radius:15,type:"manyBullets",firingPattern:{bulletCount:5,initialAngle:0,fireRate:1,lastFired:0,speed:8}}},S={fast:{title:"Rapid Fire",description:"Fires 4 bullets with high fire rate"},fastBullets:{title:"Fast Bullets",description:"Fires 4 bullets with normal fire rate"},manyBullets:{title:"Multi-Shot",description:"Fires 5 bullets with normal fire rate"}};function me(e){let a=null,n=!1,i=null;const t=document.createElement("div");t.id="turret-ui",t.className="fixed right-4 top-1/4 bg-black/80 bg-opacity-80 p-4 rounded-lg shadow-lg text-white w-64 hidden",t.innerHTML=`
    <h2 class="text-lg font-bold mb-4">Choose a Turret</h2>
    <button id="fast-turret" class="w-full border-2 border-transparent hover:border-white text-white py-2 px-4 mb-2 gap-2 rounded flex items-center cursor-pointer transition-all">
      <img src="${k[R.fast].src}" class="w-6 h-6" alt="Fast Turret" />
      <div class="text-left">
        <span class="font-bold">${S.fast.title}</span>
        <p class="text-sm">${S.fast.description}</p>
      </div>
    </button>
    <button id="fast-bullets-turret" class="w-full border-2 border-transparent hover:border-white text-white py-2 px-4 mb-2 gap-2 rounded flex items-center cursor-pointer transition-all">
      <img src="${k[R.fastBullets].src}" class="w-6 h-6" alt="Fast Bullets Turret" />
      <div class="text-left">
        <span class="font-bold">${S.fastBullets.title}</span>
        <p class="text-sm">${S.fastBullets.description}</p>
      </div>
    </button>
    <button id="many-bullets-turret" class="w-full border-2 border-transparent hover:border-white text-white py-2 px-4 gap-2 rounded flex items-center cursor-pointer transition-all">
      <img src="${k[R.manyBullets].src}" class="w-6 h-6" alt="Multi-Shot Turret" />
      <div class="text-left">
        <span class="font-bold">${S.manyBullets.title}</span>
        <p class="text-sm">${S.manyBullets.description}</p>
      </div>
    </button>
  `,document.body.appendChild(t),h.on("waveCleared",()=>{n=!0,t.classList.remove("hidden")}),h.on("waveStarted",()=>{n=!1,a=null,i=null,t.classList.add("hidden")});const r=document.getElementById("fast-turret"),l=document.getElementById("fast-bullets-turret"),o=document.getElementById("many-bullets-turret");return r==null||r.addEventListener("click",()=>{a="fast",i={...A.fast,x:0,y:0}}),l==null||l.addEventListener("click",()=>{a="fastBullets",i={...A.fastBullets,x:0,y:0}}),o==null||o.addEventListener("click",()=>{a="manyBullets",i={...A.manyBullets,x:0,y:0}}),e.addEventListener("mousemove",d=>{if(s.waveEnding&&i){const c=e.getBoundingClientRect();i.x=d.clientX-c.left+s.camera.x,i.y=d.clientY-c.top+s.camera.y}}),e.addEventListener("click",d=>{if(s.waveEnding&&n&&a&&i){const c=e.getBoundingClientRect(),f=d.clientX-c.left+s.camera.x,p=d.clientY-c.top+s.camera.y,g={...A[a],x:f,y:p};s.turrets.push(g),n=!1,a=null,i=null}}),{getPreviewTurret:()=>i}}function we(){const e=document.getElementById("position-info");e&&(e.textContent=`Position: x: ${Math.round(s.player.x)}, y: ${Math.round(s.player.y)} | HP: ${s.player.hp}`)}async function xe(e,a){let n=null;fe(),le(),ie(e);const i=me(e.canvas);function t(r=0){if(s.gameOver){ce(e),a();return}const{playerNextX:l,playerNextY:o}=j(e.canvas);V(),z(r),ge(r),ve(),Z(e.canvas,l,o,r),ee(),s.enemies.length===0&&!s.gameOver&&!s.waveEnding&&h.emit("waveCleared",r),ue(e),K(e),F(e,s.playerBullets),_(e),Q(e),F(e,s.enemyBullets),he(e),pe(),N(e),oe(e),ye(e,i.getPreviewTurret()),ne(e,r),I(s.enemyBullets,e.canvas),I(s.playerBullets,e.canvas),I(s.turretBullets,e.canvas),we(),h.emit("update",r),n=requestAnimationFrame(t)}return t(),()=>{n!==null&&cancelAnimationFrame(n)}}function Me(e){const a={x:E.canvasW/2,y:E.canvasH/2,radius:20,speed:4,color:"#f3e8ff",firingPattern:{bulletCount:4,initialAngle:0,fireRate:1,lastFired:0,speed:8},hp:10,maxHp:10},n={x:a.x-e.offsetWidth/2,y:a.y-e.offsetHeight/2,width:e.offsetWidth,height:e.offsetHeight};return{player:a,camera:n}}const be=[{type:"rectangle",x:250,y:250,width:60,height:500,color:"#f4f4f5"},{type:"circle",x:E.canvasW/2-200,y:E.canvasH/2,radius:100,color:"#fef9c3"},{type:"rectangle",x:E.canvasW-650,y:E.canvasH-450,width:450,height:250,color:"#f4f4f5"}];function Be(e){const a=document.createElement("div");a.id="dev-console",a.style.display="none",a.className="fixed top-2 left-2 w-96 bg-black/80 text-white p-4 rounded-lg z-50 duration-300 font-mono";const n=document.createElement("input");n.type="text",n.placeholder="Enter command (e.g., help)",n.className="w-full bg-transparent border border-white text-white p-2 rounded focus:outline-none focus:ring-2 focus:ring-white/50";const i=document.createElement("div");i.id="console-output",i.className="max-h-24 overflow-y-auto mt-2 text-sm",a.appendChild(n),a.appendChild(i),e.appendChild(a);function t(r){const l=document.createElement("div");l.textContent=r,i.appendChild(l),i.scrollTop=i.scrollHeight}n.addEventListener("keydown",r=>{if(r.key==="Enter"&&n.value.trim()){const[l,...o]=n.value.trim().split(/\s+/);h.emit("consoleCommand",l,o),t(`> ${n.value}`),n.value=""}}),document.addEventListener("keydown",r=>{(r.key==="`"||r.key==="~")&&(r.preventDefault(),a.style.display=a.style.display==="none"?"block":"none",a.style.display==="block"&&n.focus())}),h.on("consoleCommand",(r,l)=>{t(`Executed: ${r} ${l.join(" ")}`)})}function Pe(){h.on("consoleCommand",(e,a)=>{switch(e.toLowerCase()){case"setplayerhp":Ee(a);break;case"killall":ke();break;default:return}})}const Ee=e=>{const a=parseInt(e[0],10);if(isNaN(a)||a<0){h.emit("consoleCommand","error",["Invalid HP value. Use a positive number."]);return}s.player.hp=a,s.player.hp=Math.min(s.player.hp,s.player.maxHp),h.emit("consoleCommand","success",[`Player HP set to ${a}`])},ke=()=>{const e=[...s.enemies],a=Date.now();e.forEach(n=>{h.emit("enemyKilled",n,a)}),h.emit("consoleCommand","success",[`Killed ${e.length} enemies`])};function Ce(){window.location.reload()}function Se(){const e=document.getElementById("app"),a=document.getElementById("playBtn"),n=document.getElementById("restartBtn");function i(){n.style.display="block",n.style.position="absolute",n.style.top="50%",n.style.left="50%",n.style.transform="translateX(-50%)"}a.addEventListener("click",async()=>{a.remove(),await G();const r=de(e).getContext("2d"),{player:l,camera:o}=Me(e);s.player=l,s.camera=o,s.obstacles=be;const d=W(e,l);s.keys=d.keys,Be(e),Pe();const c=await xe(r,i);n.addEventListener("click",Ce),document.addEventListener("keydown",f=>{f.key==="Escape"&&c&&(c(),i())})})}Se();
