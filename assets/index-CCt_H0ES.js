(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();function F(t){const e=document.createElement("canvas");e.id="gameCanvas",t.appendChild(e);const s=e.getContext("2d");return e.width=1200,e.height=1200,s.fillRect(0,0,e.width,e.height),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.addEventListener("resize",()=>{s.fillRect(0,0,e.width,e.height)}),e}function D(t,e){const s=document.createElement("div");s.id="control-panel",s.className="absolute bottom-4 left-4 bg-gray-800 text-white p-4 rounded opacity-50",s.innerHTML=`
    <p>Use W, A, S, D keys to move your avatar</p>
    <p id="position-info">Position: x: ${Math.round(e.x)}, y: ${Math.round(e.y)}</p>
    <div class="key-grid grid grid-cols-3 gap-2 text-center">
      <div></div>
      <div id="key-w" class="bg-gray-700 rounded p-2">W</div>
      <div></div>
      <div id="key-a" class="bg-gray-700 rounded p-2">A</div>
      <div id="key-s" class="bg-gray-700 rounded p-2">S</div>
      <div id="key-d" class="bg-gray-700 rounded p-2">D</div>
    </div>
  `;const a={w:!1,a:!1,s:!1,d:!1};document.addEventListener("keydown",o=>{const r=o.key.toLowerCase();r in a&&(a[r]=!0,n(r,!0))}),document.addEventListener("keyup",o=>{const r=o.key.toLowerCase();r in a&&(a[r]=!1,n(r,!1))});function n(o,r){const d=document.getElementById(`key-${o}`);d.classList.toggle("bg-blue-500",r),d.classList.toggle("bg-gray-700",!r)}return{controlPanel:s,keys:a}}function O(t,e,s,a){t.save(),t.translate(-s,-a),e.forEach(n=>{n.type==="rectangle"&&(t.fillStyle=n.color,t.fillRect(n.x,n.y,n.width,n.height)),n.type==="circle"&&(t.beginPath(),t.arc(n.x,n.y,n.radius,0,Math.PI*2),t.fillStyle=n.color,t.fill())}),t.restore()}function H(t,e,s,a){let n=s,o=a,r=t.x+n,d=t.y+o;return e.forEach(l=>{if(l.type==="rectangle"){const i=Math.max(l.x,Math.min(r,l.x+l.width)),h=Math.max(l.y,Math.min(d,l.y+l.height)),c=r-i,g=d-h,w=c*c+g*g;if(w<t.radius*t.radius){const f=Math.sqrt(w),u=t.radius-f;if(f===0)r+=u;else{const b=c/f,S=g/f;r+=b*u,d+=S*u}}}else if(l.type==="circle"){const i=r-l.x,h=d-l.y,c=Math.sqrt(i*i+h*h),g=t.radius+l.radius;if(c<g){const w=g-c;if(c===0)r+=w;else{const f=i/c,u=h/c;r+=f*w,d+=u*w}}}}),n=r-t.x,o=d-t.y,{dx:n,dy:o}}function L(t,e,s,a,n,o,r=3){const d=[];if(s<=0)return d;const l=360/s;for(let i=0;i<s;i++){const c=(a+i*l)*Math.PI/180,g=Math.cos(c)*n,w=Math.sin(c)*n,f={x:t,y:e,vx:g,vy:w,radius:r,speed:n,color:o};d.push(f)}return d}function C(t,e,s){for(let a=t.length-1;a>=0;a--){const n=t[a];n.x+=n.vx,n.y+=n.vy;let o=!1;for(const r of s)if(r.type==="rectangle"){const d=Math.max(r.x,Math.min(n.x,r.x+r.width)),l=Math.max(r.y,Math.min(n.y,r.y+r.height)),i=n.x-d,h=n.y-l;if(i*i+h*h<n.radius*n.radius){o=!0;break}}else if(r.type==="circle"){const d=n.x-r.x,l=n.y-r.y,i=Math.sqrt(d*d+l*l),h=n.radius+r.radius;if(i<h){o=!0;break}}(o||n.x<0||n.x>e.width||n.y<0||n.y>e.height)&&t.splice(a,1)}}function q(t,e,s,a){t.save(),t.translate(-s,-a),e.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,n.radius,0,Math.PI*2),t.fillStyle=n.color,t.fill(),t.closePath()}),t.restore()}function $(t){const e=document.createElement("canvas").getContext("2d");if(!e)return 0;e.fillStyle=t,e.fillRect(0,0,1,1);const[s,a,n]=e.getImageData(0,0,1,1).data;return .299*s+.587*a+.114*n}function T(t,e,s,a){t.save(),t.translate(-s,-a),e.forEach(n=>{t.beginPath(),t.arc(n.x,n.y,n.radius,0,Math.PI*2),t.fillStyle=n.color,t.fill(),t.closePath();const r=$(n.color)>150?"black":"white";t.fillStyle=r,t.font="bold 16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(`${n.hp}`,n.x,n.y)}),t.restore()}function N(t,e,s,a,n,o,r,d){let l=!1;return t.forEach((i,h)=>{const c=Math.sqrt(i.vx*i.vx+i.vy*i.vy);c!==0&&(i.vx=i.vx/c*i.speed,i.vy=i.vy/c*i.speed);const g=d-i.firingPattern.lastFired,w=1e3/i.firingPattern.fireRate;if(g>=w){const v=L(i.x,i.y,i.firingPattern.bulletCount,i.firingPattern.initialAngle,i.firingPattern.speed,i.color);r.push(...v),i.firingPattern.lastFired=d}let f=i.x+i.vx,u=i.y+i.vy;(f-i.radius<0||f+i.radius>o.width)&&(i.vx=-i.vx,f=i.x+i.vx),(u-i.radius<0||u+i.radius>o.height)&&(i.vy=-i.vy,u=i.y+i.vy),n.forEach(v=>{if(v.type==="rectangle"){const p=Math.max(v.x,Math.min(f,v.x+v.width)),M=Math.max(v.y,Math.min(u,v.y+v.height)),x=f-p,y=u-M,B=x*x+y*y;if(B<i.radius*i.radius){const P=Math.sqrt(B);if(P!==0){const k=x/P,E=y/P,Y=i.vx*k+i.vy*E;i.vx-=2*Y*k,i.vy-=2*Y*E,i.vx+=(Math.random()-.5)*.5,i.vy+=(Math.random()-.5)*.5;const R=Math.sqrt(i.vx*i.vx+i.vy*i.vy);i.vx=i.vx/R*i.speed,i.vy=i.vy/R*i.speed}else i.vx=-i.vx,i.vy=-i.vy;f=i.x+i.vx,u=i.y+i.vy}}else if(v.type==="circle"){const p=f-v.x,M=u-v.y,x=Math.sqrt(p*p+M*M),y=i.radius+v.radius;if(x<y){if(x!==0){const B=p/x,P=M/x,k=i.vx*B+i.vy*P;i.vx-=2*k*B,i.vy-=2*k*P,i.vx+=(Math.random()-.5)*.5,i.vy+=(Math.random()-.5)*.5;const E=Math.sqrt(i.vx*i.vx+i.vy*i.vy);i.vx=i.vx/E*i.speed,i.vy=i.vy/E*i.speed}else i.vx=-i.vx,i.vy=-i.vy;f=i.x+i.vx,u=i.y+i.vy}}});const b=f-s,S=u-a;if(Math.sqrt(b*b+S*S)<i.radius+e.radius){l=!0;return}for(let v=0;v<t.length;v++){if(v===h)continue;const p=t[v],M=f-p.x,x=u-p.y,y=Math.sqrt(M*M+x*x),B=i.radius+p.radius;if(y<B){const P=B-y;if(y!==0){const k=M/y,E=x/y;f+=k*P*.5,u+=E*P*.5,p.x-=k*P*.5,p.y-=E*P*.5;const Y=i.vx*k+i.vy*E;i.vx-=2*Y*k,i.vy-=2*Y*E,i.vx+=(Math.random()-.5)*.5,i.vy+=(Math.random()-.5)*.5;const R=Math.sqrt(i.vx*i.vx+i.vy*i.vy);i.vx=i.vx/R*i.speed,i.vy=i.vy/R*i.speed}else f+=P,i.vx=-i.vx,i.vy=-i.vy;f=i.x+i.vx,u=i.y+i.vy}}i.x=f,i.y=u}),l}function G(t,e,s,a){for(let n=t.length-1;n>=0;n--){const o=t[n];for(let r=e.length-1;r>=0;r--){const d=e[r],l=d.x-o.x,i=d.y-o.y,h=Math.sqrt(l*l+i*i),c=d.radius+o.radius;if(h<c&&(o.hp-=1,e.splice(r,1),o.hp<=0)){const g=["extraBullet","fasterFireRate","fasterBullets"],w=g[Math.floor(Math.random()*g.length)],f={x:o.x,y:o.y,width:24,height:24,type:w,spawnTime:a};s.push(f),t.splice(n,1);break}}}}function m(t,e,s,a,n,o){t.save(),t.translate(-a,-n),t.strokeStyle="white",t.lineWidth=2,t.strokeRect(0,0,e,s),t.restore(),t.save(),t.font="bold 24px Arial",t.fillStyle="white",t.strokeStyle="black",t.lineWidth=2,t.textAlign="center",t.textBaseline="top",t.strokeText(`Wave: ${o}`,t.canvas.width/2,10),t.fillText(`Wave: ${o}`,t.canvas.width/2,10),t.restore()}function I(t,e,s){t.save(),t.translate(-e.x,-e.y),t.fillStyle="black",t.fillRect(e.x,e.y,e.width,e.height),t.font="48px Arial",t.fillStyle=s?"red":"green",t.textAlign="center",t.textBaseline="middle";const a=s?"You died":"Victory!";t.fillText(a,e.x+e.width/2,e.y+e.height/2),t.restore()}const j={extraBullet:"/dot-game/extraBullet.svg",fasterFireRate:"/dot-game/fasterFireRate.svg",fasterBullets:"/dot-game/fasterBullets.svg"},W={};async function U(){const t=Object.entries(j).map(([e,s])=>new Promise((a,n)=>{const o=new Image;o.src=s,o.onload=()=>{W[e]=o,a()},o.onerror=()=>{console.error(`Failed to load power-up icon: ${s}`),n()}}));await Promise.all(t),console.log("All power-up icons loaded successfully")}function K(t,e,s,a){t.save(),t.translate(-s,-a),e.forEach(n=>{const o=W[n.type];if(o){const r=n.width,d=n.height;t.drawImage(o,n.x-r/2,n.y-d/2,r,d)}}),t.restore()}function z(t,e){for(let s=e.length-1;s>=0;s--){const a=e[s],n=a.x-t.x,o=a.y-t.y,r=Math.sqrt(n*n+o*o),d=t.radius+Math.max(a.width,a.height)/2;if(r<d){switch(a.type){case"extraBullet":t.firingPattern.bulletCount+=1;break;case"fasterFireRate":t.firingPattern.fireRate+=1;break;case"fasterBullets":t.firingPattern.speed+=2;break;default:{const l=a.type;throw new Error(`Unhandled power-up type: ${l}`)}}e.splice(s,1)}}}function V(t,e){for(let a=t.length-1;a>=0;a--){const n=t[a];e-n.spawnTime>12e3&&t.splice(a,1)}}function J(){const t=["yellow","blue","pink","green","orange","purple"];return t[Math.floor(Math.random()*t.length)]}function Q(t,e,s,a){for(const n of a)if(n.type==="rectangle"){const o=Math.max(n.x,Math.min(t,n.x+n.width)),r=Math.max(n.y,Math.min(e,n.y+n.height)),d=t-o,l=e-r;if(d*d+l*l<s*s)return!0}else if(n.type==="circle"){const o=t-n.x,r=e-n.y,d=Math.sqrt(o*o+r*r),l=s+n.radius;if(d<l)return!0}return!1}function Z(t,e,s,a){let o,r,d=0;const l=3;let i=!0,h=!0;do{o=Math.random()*(t-60)+30,r=Math.random()*(e-60)+30;const p=o-s.x,M=r-s.y;if(i=Math.sqrt(p*p+M*M)<100+s.radius+15,h=Q(o,r,15,a),d++,d>l){o=t/2,r=e/2;break}}while(i||h);const c=Math.random()*Math.PI*2,g=Math.random()*3+2,w=Math.cos(c)*g,f=Math.sin(c)*g,u=Math.floor(Math.random()*4)+2,b=Math.floor(Math.random()*5)+1,S=Math.random()*360,X=Math.random()*2+.5,v=Math.random()*3+3;return{x:o,y:r,radius:15,vx:w,vy:f,speed:g,color:J(),firingPattern:{bulletCount:b,initialAngle:S,fireRate:X,lastFired:0,speed:v},hp:u}}function A(t,e,s,a,n){const o=[];for(let r=0;r<t;r++)o.push(Z(e,s,a,n));return o}function _(t,e,s){t.save(),t.translate(-s.x,-s.y),t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.PI*2),t.fillStyle=e.color,t.fill(),t.closePath(),t.font="14px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText("You",e.x,e.y),t.restore()}function tt(t,e,s,a,n){e.x=t.x-e.width/2,e.y=t.y-e.height/2,e.x=Math.max(0,Math.min(n.width-e.width,e.x)),e.y=Math.max(0,Math.min(n.height-e.height,e.y));let o=0,r=0;if(s.w&&(r-=t.speed),s.s&&(r+=t.speed),s.a&&(o-=t.speed),s.d&&(o+=t.speed),o!==0&&r!==0){const c=Math.sqrt(o*o+r*r);o=o/c*t.speed,r=r/c*t.speed}const{dx:d,dy:l}=H(t,a,o,r),i=t.x+d,h=t.y+l;return t.x=i,t.y=h,t.x=Math.max(t.radius,Math.min(n.width-t.radius,t.x)),t.y=Math.max(t.radius,Math.min(n.height-t.radius,t.y)),{playerNextX:i,playerNextY:h}}function it(t,e,s){const a=e-t.firingPattern.lastFired,n=1e3/t.firingPattern.fireRate;if(a>=n){const o=L(t.x,t.y,t.firingPattern.bulletCount,t.firingPattern.initialAngle,t.firingPattern.speed,t.color);s.push(...o),t.firingPattern.lastFired=e}}function nt(t,e){let s=!1;for(let a=e.length-1;a>=0;a--){const n=e[a],o=n.x-t.x,r=n.y-t.y,d=Math.sqrt(o*o+r*r),l=n.radius+t.radius;if(d<l&&(t.hp-=1,e.splice(a,1),t.hp<=0)){s=!0;break}}return s}function et(t,e){t.fillStyle="red",t.fillRect(10,10,200,20);const d=e.hp/10*200;t.fillStyle="green",t.fillRect(10,10,d,20),t.strokeStyle="white",t.lineWidth=2,t.strokeRect(10,10,200,20),t.font="16px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(`${e.hp}/10`,10+200/2,10+20/2)}function st(t){const e=document.getElementById("position-info");e&&(e.textContent=`Position: x: ${Math.round(t.x)}, y: ${Math.round(t.y)} | HP: ${t.hp}`)}function ot(t){t.fillStyle="black",t.fillRect(0,0,t.canvas.width,t.canvas.height)}async function rt(t,e,s,a,n,o){await U();let r=!1,d=null;const l=[],i=[],h=[];let c=A(1,t.canvas.width,t.canvas.height,e,n),g=1;const w=t.canvas.width,f=t.canvas.height;function u(b=0){if(r){I(t,s,r),o();return}const{playerNextX:S,playerNextY:X}=tt(e,s,a,n,t.canvas);if(it(e,b,l),nt(e,i)&&(r=!0),N(c,e,S,X,n,t.canvas,i,b)&&(r=!0),G(c,l,h,b),c.length===0&&!r){if(g++,g>4){I(t,s,r),o();return}c=A(g,t.canvas.width,t.canvas.height,e,n)}z(e,h),V(h,b),C(l,t.canvas,n),C(i,t.canvas,n),st(e),ot(t),m(t,w,f,s.x,s.y,g),q(t,l,s.x,s.y),q(t,i,s.x,s.y),O(t,n,s.x,s.y),T(t,c,s.x,s.y),_(t,e,s),K(t,h,s.x,s.y),et(t,e),d=requestAnimationFrame(u)}return u(),()=>{d!==null&&cancelAnimationFrame(d)}}const at=[{type:"rectangle",x:300,y:300,width:100,height:50,color:"gray"},{type:"circle",x:500,y:500,radius:30,color:"gray"},{type:"rectangle",x:800,y:700,width:150,height:60,color:"gray"}];function dt(){const t={x:600,y:600,radius:20,speed:4,color:"red",firingPattern:{bulletCount:4,initialAngle:0,fireRate:1,lastFired:0,speed:8},hp:10},e={x:t.x-window.innerWidth/2,y:t.y-window.innerHeight/2,width:window.innerWidth,height:window.innerHeight};return{player:t,camera:e}}function lt(){const t=document.getElementById("app"),e=document.getElementById("playBtn"),s=document.getElementById("restartBtn");e.addEventListener("click",async()=>{e.remove(),t.className="";const n=F(t).getContext("2d"),{player:o,camera:r}=dt(),d=D(t,o);function l(){window.location.reload()}function i(){s.style.display="block",s.style.position="absolute",s.style.top="50%",s.style.left="50%",s.style.transform="translateX(-50%)"}const h=await rt(n,o,r,d.keys,at,i);s.addEventListener("click",l),document.addEventListener("keydown",c=>{c.key==="Escape"&&h&&(h(),i())})})}lt();
